name: ğŸ“š Sync Weekly Notes to Wiki

on:
  push:
    paths:
      - 'weekly_notes/**'
    branches:
      - main

jobs:
  publish-wiki:
    runs-on: ubuntu-latest

    steps:
      - name: ğŸ“¥ Checkout main repo
        uses: actions/checkout@v3

      - name: ğŸ§  Set up Git
        run: |
          git config --global user.email "actions@github.com"
          git config --global user.name "GitHub Actions"

      - name: ğŸ“¥ Clone Wiki
        run: |
          git clone https://github.com/Ziforge/Neuroverse.wiki.git wiki

      - name: ğŸ“ Copy notes into Wiki
        run: |
          for file in weekly_notes/week*.md; do
            filename=$(basename "$file")
            weekname="${filename%.*}"
            title=$(echo "$weekname" | sed 's/week/Week-/' | sed 's/_/-/g')
            cp "$file" "wiki/${title}-Progress.md"
            echo "âœ… Added $file as ${title}-Progress.md"
          done

      - name: ğŸ—‚ï¸ Update Wiki Sidebar
        run: |
          cd wiki
          echo "## ğŸ§­ Wiki Navigation" > _Sidebar.md
          echo "- [Home](Home)" >> _Sidebar.md
          echo "- [Development Guide](Development-Setup-Guide)" >> _Sidebar.md
          echo "- [Automation Script](Automation-Script)" >> _Sidebar.md
          echo -e "\n## ğŸ“… Weekly Progress" >> _Sidebar.md
          for file in Week-*-Progress.md; do
            name="${file%.md}"
            echo "- [${name//-/ }](\"$name\")" >> _Sidebar.md
          done
          git add . && git commit -m "ğŸ¤– Auto-sync weekly notes to wiki" && git push
